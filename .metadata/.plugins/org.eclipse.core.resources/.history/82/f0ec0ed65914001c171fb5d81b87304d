package com.demo.service;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.ExceptionHandler;

import com.demo.customException.FlightException;
import com.demo.models.Flight;
import com.demo.repositories.FlightRepository;

@Service
public class FlightService {

	@Autowired
	private FlightRepository flightRepository;

	public List<Flight> getAllFlight() {
		return flightRepository.findAll();

	}

	public String updateFlight(List<Flight> flight) {
		if (flight.size() > 0) {
			for (Flight f : flight) {
				if (flightRepository.getFlightDetails(f) != null) {
					flightRepository.save(f);
					return "Flight details updated by admin";
				} else {
					flightRepository.save(f);
					return "Flight details stored by admin";
				}
			}
		} else {
			return "Nothing to update";
		}
	}

	public List<Flight> getFlight(List<Flight> flight) throws FlightException {
		if (flight.size() > 0) {
			for (Flight f : flight) {
				Optional<Flight> optional = flightRepository.findById(f.getFlightId());
				if (optional.isPresent()) {
					return (List<Flight>) optional.get();
				} else {
					throw new FlightException("Flight not found in db");
				}
			}

		}
		return flight;
	}

	@ExceptionHandler(value = FlightException.class)
	public String deleteFlight(Flight flight) throws FlightException {
		Flight flightFromDb = getFlight(flight);
		if (flightFromDb == null) {
			throw new FlightException("The Flight You are trying to delete is not present in Database");
		} else {
			flightRepository.delete(flightFromDb);
			return "Flight successfully deleted from Database";
		}
	}

}
